<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Meal Tracker</title>
  <link rel="stylesheet" href="/css/home.css" />
</head>
<body>

  <!-- Header -->
  <header class="app-header">
    <h1>üçΩ Meal Tracker</h1>
    <p>Smart calorie estimation ‚Äî not guesswork</p>
  </header>

  <main class="container">

    <!-- Add Meal -->
    <section class="card">
      <h2>Add Meal</h2>

      <form method="POST" action="/add" class="form">

        <!-- Meal Type -->
        <label>Meal Type</label>
        <select name="mealType" required>
          <option value="">Select meal</option>
          <option value="breakfast">Breakfast</option>
          <option value="lunch">Lunch</option>
          <option value="snacks">Snacks / Evening</option>
          <option value="dinner">Dinner</option>
        </select>

        <!-- Food -->
        <label>Food</label>
        <select name="food" required>
          <option value="">Select food</option>

          <option value="rice">Rice</option>
          <option value="fried_rice">Fried Rice</option>
          <option value="chapati">Chapati</option>
          <option value="paratha">Paratha</option>
          <option value="bread">Bread</option>

          <option value="dal">Dal</option>
          <option value="rajma">Rajma</option>
          <option value="chole">Chole</option>
          <option value="paneer_curry">Paneer Curry</option>
          <option value="veg_curry">Veg Curry</option>

          <option value="egg">Egg</option>
          <option value="omelette">Omelette</option>
          <option value="milk">Milk</option>
          <option value="curd">Curd</option>

          <option value="banana">Banana</option>
          <option value="apple">Apple</option>
          <option value="mango">Mango</option>

          <option value="samosa">Samosa</option>
          <option value="pakora">Pakora</option>
          <option value="tea">Tea</option>
          <option value="coffee">Coffee</option>
        </select>

        <!-- Quantity + Unit -->
        <div class="row">
          <div>
            <label>Quantity</label>
            <input type="number" name="quantity" min="1" required />
          </div>

          <div>
            <label>Unit</label>
            <select name="unit">
              <option value="plate">Plate</option>
              <option value="piece">Piece</option>
              <option value="cup">Cup</option>
              <option value="bowl">Bowl</option>
            </select>
          </div>
        </div>

        <button type="submit">Add Meal</button>
      </form>
    </section>

    <!-- Total Calories -->
    <section class="card highlight">
      <h2>Total Calories Today</h2>
      <div class="total">
        <%= totalCalories %> <span>kcal</span>
      </div>
    </section>

    <div class="filter-bar">
  <a href="/">Today</a>
  <a href="/yesterday">Yesterday</a>
</div>


    <!-- Meals -->
    <section class="card">
  <h2>Meals</h2>
        <% if (Object.keys(groupedByDate).length === 0) { %>
  <p class="empty">
    No meals recorded for this day üçΩÔ∏è
  </p>
<% } %>

  <% 
    const labels = {
      breakfast: "üç≥ Breakfast",
      lunch: "üçõ Lunch",
      snacks: "‚òï Snacks / Evening",
      dinner: "üåô Dinner"
    };

    const formatDate = (d) =>
      new Date(d).toLocaleDateString("en-IN", {
        weekday: "short",
        day: "numeric",
        month: "short",
        year: "numeric",
      });
  %>

  <% for (let key in groupedByDate) { %>
    <div class="day-block">

      <!-- Date Header -->
      <div class="day-header">
        <h3>üìÖ <%= formatDate(groupedByDate[key].date) %></h3>
        <span class="day-total">
          <%= groupedByDate[key].total %> kcal
        </span>
      </div>

      <% for (let type in groupedByDate[key].meals) { %>
        <% if (groupedByDate[key].meals[type].length > 0) { %>

          <h4 class="meal-heading"><%= labels[type] %></h4>

          <ul class="meal-list">
            <% groupedByDate[key].meals[type].forEach(m => { %>
              <li>
                <div>
                  <strong><%= (m.food || "unknown").replace(/_/g, " ") %></strong>
                  <span><%= m.quantity %> <%= m.unit %></span>
                </div>

                <div class="right">
                  <span class="calories"><%= m.total %> kcal</span>

                  <form method="POST" action="/delete/<%= m._id %>">
                    <button class="delete-btn">‚úñ</button>
                  </form>
                </div>
              </li>
            <% }) %>
          </ul>

        <% } %>
      <% } %>

    </div>
  <% } %>
</section>


  </main>

</body>
</html>
